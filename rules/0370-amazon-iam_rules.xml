<!--
  -  Amazon IAM rules
  -  Created by Wazuh, Inc. <support@wazuh.com>.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->

<!-- ID: 80800 - 80999 -->

<group name="amazon-iam,">

    <rule id="80801" level="3">
        <if_sid>80202</if_sid>
        <field name="eventName">ConsoleLogin</field>
        <description>Amazon-signin: User Login Success</description>
        <group>amazon,authentication_success,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80802" level="5">
        <if_sid>80801</if_sid>
        <field name="ConsoleLogin">Failure</field>
        <description>Amazon-signin: User Login failed</description>
        <group>amazon,authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80803" level="10" frequency="4" timeframe="360">
        <if_matched_sid>80802</if_matched_sid>
        <description>Possible breakin attempt (high number of login attempts).</description>
        <group>amazon,authentication_failures,pci_dss_11.4,pci_dss_10.2.4,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80804" level="2">
        <if_sid>80202</if_sid>
        <field name="eventName">AttachGroupPolicy|AttachUserPolicy|AttachRolePolicy|CreateGroup|CreateRole|CreateAccountAlias|UpdateInstanceAlias|GetGroup|ListGroups|ListUsers|DeleteUser</field>
        <description>Amazon-IAM: $(eventName)</description>
        <group>amazon,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80805" level="3">
        <if_sid>80202</if_sid>
        <field name="eventName">CreateUser|AddUserToGroup|RemoveUserFromGroup|DetachGroupPolicy|DetachRolePolicy|DeleteAccountAlias</field>
        <description>Amazon-IAM: $(eventName)</description>
        <group>amazon,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80806" level="2">
        <if_sid>80202</if_sid>
        <field name="eventName">UpdateAccessKey|CreatePolicy|UpdateAccountPasswordPolicy</field>
        <description>Amazon-IAM: $(eventName)</description>
        <group>amazon,pci_dss_10.6.1,</group>
    </rule>

    <rule id="80807" level="5">
        <if_sid>80804</if_sid>
        <field name="errorCode">\.+</field>
        <description>Amazon-IAM: $(eventName) - $(errorCode)</description>
        <group>amazon,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80808" level="5">
        <if_sid>80805</if_sid>
        <field name="errorCode">\.+</field>
        <description>Amazon-IAM: $(eventName) - $(errorCode)</description>
        <group>amazon,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80809" level="5">
        <if_sid>80806</if_sid>
        <field name="errorCode">\.+</field>
        <description>Amazon-IAM: $(eventName) - $(errorCode)</description>
        <group>amazon,pci_dss_10.6.1,</group>
    </rule>

    <rule id="80810" level="5">
        <if_sid>80804</if_sid>
        <field name="errorCode">AccessDenied</field>
        <description>Amazon-IAM: $(eventName) - $(errorCode)</description>
        <group>amazon,pci_dss_10.2.4,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80811" level="5">
        <if_sid>80805</if_sid>
        <field name="errorCode">AccessDenied</field>
        <description>Amazon-IAM: $(eventName) - $(errorCode)</description>
        <group>amazon,pci_dss_10.2.4,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80812" level="5">
        <if_sid>80804</if_sid>
        <field name="errorCode">NoSuchEntityException</field>
        <description>Amazon-IAM: $(eventName) - $(errorCode)</description>
        <group>amazon,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80813" level="5">
        <if_sid>80805</if_sid>
        <field name="errorCode">NoSuchEntityException</field>
        <description>Amazon-IAM: $(eventName) - $(errorCode)</description>
        <group>amazon,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80814" level="5">
        <if_sid>80806</if_sid>
        <field name="errorCode">AccessDenied</field>
        <description>Amazon-IAM: $(eventName) - $(errorCode)</description>
        <group>amazon,pci_dss_10.6.1,</group>
    </rule>

    <rule id="80815" level="5">
        <if_sid>80202</if_sid>
        <field name="eventName">DisableKey</field>
        <description>Attempts to delete the KMS keys/users.</description>
        <group>amazon-kms,pci_dss_10.2.5,</group>
    </rule>

    <rule id="80816" level="5">
       <if_sid>80202</if_sid>
       <field name="eventName">ListAliases</field>
       <description>Access to KMS keys/users.</description>
       <group>amazon-kms,pci_dss_10.2.5,</group>
    </rule>

</group>
