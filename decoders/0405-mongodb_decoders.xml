<!--
  -  MongoDB decoders
  -  Created by Wazuh, Inc. <support@wazuh.com>.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->


<decoder name="mongodb">
    <prematch>^\d+-\d+-\d+T\d+:\d+:\d+.\d++\d+ \w \S+\s+[</prematch>
</decoder>


<!--
2017-03-27T19:32:31.916+0200 I ACCESS   [conn10000] Successfully authenticated as principal snapshots on andfrankly
-->
<decoder name="mongodb-successauth">
    <parent>mongodb</parent>
    <prematch>^\d+-\d+-\d+T\d+:\d+:\d+.\d++\d+ \w \w+   [\w+] Successfully</prematch>
    <regex>^\d+-\d+-\d+T\d+:\d+:\d+.\d++\d+ (\w) (\w+)   [(\w+)] Successfully authenticated as principal snapshots on (\w+)</regex>
    <order>mongodb.type,mongodb.desc,mongodb.context,mongodb.user</order>
</decoder>


<!--
2017-03-27T19:32:33.916+0200 I NETWORK  [conn10000] end connection 172.31.27.128:33658 (15 connections now open)
2017-03-27T19:32:34.916+0200 I NETWORK  [conn10157] end connection 172.31.27.128:60864 (1 connection now open)
-->
<decoder name="mongodb-endconnection">
    <parent>mongodb</parent>
    <prematch>^\d+-\d+-\d+T\d+:\d+:\d+.\d++\d+ \w \w+  [\w+] end connection</prematch>
    <regex>^\d+-\d+-\d+T\d+:\d+:\d+.\d++\d+ (\w) (\w+)  [(\w+)] end connection (\d+.\d+.\d+.\d+):(\d+) \((\d+)</regex>
    <order>mongodb.type,mongodb.desc,mongodb.context,srcip,srcport,mongodb.connections</order>
</decoder>

<!--
2017-03-27T19:32:35.916+0200 I NETWORK  [initandlisten] connection accepted from 172.31.2.27:32768 #19309 (10 connections now open)
2017-03-27T19:32:36.916+0200 I NETWORK  [initandlisten] connection accepted from 172.31.2.27:32768 #19309 (1 connection now open)
-->

<decoder name="mongodb-connectionaccepted">
    <parent>mongodb</parent>
    <prematch>^\d+-\d+-\d+T\d+:\d+:\d+.\d++\d+ \w \w+  [\w+] connection accepted</prematch>
    <regex>^\d+-\d+-\d+T\d+:\d+:\d+.\d++\d+ (\w) (\w+)  [(\w+)] connection accepted from (\d+.\d+.\d+.\d+):(\d+) #(\d+) \((\d+)</regex>
    <order>mongodb.type,mongodb.desc,mongodb.context,srcip,srcport,mongodb.nconnection,mongodb.connections</order>
</decoder>

<!--
2017-03-27T19:32:32.916+0200 I COMMAND  [conn13388] killcursors: found 0 of 1
-->
<decoder name="mongodb-generic">
    <parent>mongodb</parent>
    <regex>^\d+-\d+-\d+T\d+:\d+:\d+.\d++\d+ (\w) (\w+)  [(\w+)] </regex>
    <order>mongodb.type,mongodb.desc,mongodb.context</order>
</decoder>
